<!DOCTYPE html>
<html lang="en">
<head>
  <title>CRUD App</title>
  <meta name="description" content="Create, read, update, delete data tables.">
  <meta name="author" content="Jordan Mitchell Barrett">

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <main>
    <h1>Hello there!</h1>
    <button onclick="runTest()">Test API</button>

    <h2>Make new table</h2>
    <p>Table name:</p>
    <input type="text" id="tablename">
    <p>Table password (optional):</p>
    <input type="password" id="tablepwd">
    <button onclick="makeTable()" id="maketable">Create table</button>

    <h2>Existing tables</h2>
    <button onclick="getTables()" id="getTables">Get tables</button>

    <script>
      const server = 'https://barrettj12-crud-app.herokuapp.com'

      // Get page elements
      nameInput = document.getElementById('tablename')
      pwdInput = document.getElementById('tablepwd')


      // API test
      async function runTest() {
        fetch(server + '/test')
          .then(resp => resp.text())
          .then(msg => alert(msg))
          .catch(err => handleError(err))
      }

/*      function processMessage(message) {
        fmessage = 'New message from server: "' + message + '"'
        alert(fmessage)
        console.log(fmessage)
      }*/


      // Make new table
      async function makeTable() {
        name = nameInput.value
        pwd = pwdInput.value

        fetch(server + '/maketable', {
          method: 'POST',
          body: JSON.stringify({
            'name': name,
            'pwd': pwd
          })
        })
          .then(resp => resp.text())
          .then(msg => alert(msg))
          .catch(err => handleError(err))
      }

      // Get tables
      async function getTables() {
        fetch(server + '/tables')
          .then(resp => {
            if (resp.ok) {
              showTables(resp.json())
            }
            else {
              resp.text().then(msg => alert(msg))
            }
          })
          .catch(err => handleError(err))
      }

      // Error handling for fetch
      function handleError(err) {
        alert('Whoops, an error occurred.')
        console.log(err)
      }
    </script>
  </main>
</body>
</html>